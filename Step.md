# CRUD Product API Starter Kit
**‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Project: ProductAPI** ‡∏≠‡∏¥‡∏á‡∏´‡∏•‡∏±‡∏Å **Clean Architecture**, **SOLID Principles** ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á **Clean Code**, ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

Project ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå WebAPI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£(CRUD) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤(Product) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤ C#, Dapper(ORM ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö .NET), ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MSSQL LocalDB, ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Clean Architecture ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Clean Code ‡πÅ‡∏•‡∏∞ SOLID Principles ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á WebAPI ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ
#
### 1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ

#### 1.1 Clean Architecture ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
Clean Architecture ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Separation of Concerns) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏à‡∏≤‡∏Å Frameworks, UI, ‡πÅ‡∏•‡∏∞ Database ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠ **Domain Layer** ‡πÅ‡∏•‡∏∞ **Application Layer** ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Testable), ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (Maintainable), ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (Flexible)

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏Ç‡∏≠‡∏á Clean Architecture ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ:
* **Domain:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Entities, Value Objects, ‡πÅ‡∏•‡∏∞ Domain Logic ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
* **Application:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Use Cases (Application Logic), Interfaces ‡∏Ç‡∏≠‡∏á Repositories ‡πÅ‡∏•‡∏∞ Services ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
* **Infrastructure:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ Implement Interfaces ‡∏à‡∏≤‡∏Å Application Layer ‡πÄ‡∏ä‡πà‡∏ô Repositories (‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database), Services ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
* **Presentation (WebAPI):** ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Controllers, DTOs (Data Transfer Objects) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API

![image](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)
https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html

#### 1.2 SOLID Principles ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
SOLID ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ 5 ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Object-Oriented Programming ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢:
* **S - Single Responsibility Principle (SRP):** Class ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
* **O - Open/Closed Principle (OCP):** Software entities (classes, modules, functions, etc.) ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢ (extension) ‡πÅ‡∏ï‡πà‡∏õ‡∏¥‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (modification)
* **L - Liskov Substitution Principle (LSP):** Objects ‡∏Ç‡∏≠‡∏á Superclass ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ Objects ‡∏Ç‡∏≠‡∏á Subclass ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
* **I - Interface Segregation Principle (ISP):** Client ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ implement interface ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
* **D - Dependency Inversion Principle (DIP):** High-level modules ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Low-level modules ‡πÅ‡∏ï‡πà‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Abstractions (Interfaces)

![image](https://github.com/user-attachments/assets/4e4a02da-8d36-4503-8c7c-4e4665cd718a)

#### 1.3 record  ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
`record` ‡∏Ñ‡∏∑‡∏≠ **‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (data type)** ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô C# ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà **C# 9.0** ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ (data-centric)** ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ **‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° (behavior)**

##### üßæ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á `record`

> `record` ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Immutable ‡πÇ‡∏î‡∏¢ Default ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ **Value-Based Equality** ‡πÅ‡∏ó‡∏ô **Reference-Based Equality** ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô class ‡∏õ‡∏Å‡∏ï‡∏¥

##### üîç ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏≠‡∏á `record`

| ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô                                | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î                                                    |
| -------------------------------------- | ------------------------------------------------------------- |
| ‚úÖ **Value Equality**                   | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö object ‡∏à‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å property ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà address |
| ‚úÖ **Immutable by default**             | ‡πÉ‡∏ä‡πâ `init` ‡πÅ‡∏ó‡∏ô `set`, ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á           |
| ‚úÖ **Concise Syntax**                   | ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤ class ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ö‡∏ö positional                    |
| ‚úÖ **Built-in Copy**                    | ‡πÉ‡∏ä‡πâ `with` expression ‡πÄ‡∏û‡∏∑‡πà‡∏≠ copy ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏Ñ‡πà‡∏≤            |
| ‚úÖ **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö DTO / ViewModel / Event** | ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ behavior ‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•          |

---
##### üß† ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£?

| ‡πÉ‡∏ä‡πâ `record` ‡πÄ‡∏°‡∏∑‡πà‡∏≠...                        | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•                            |
| -------------------------------------------- | --------------------------------- |
| ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Immutable Object                   | ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à |
| ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO / ViewModel                      | ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ logic ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô     |
| ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Copy ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏Ñ‡πà‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô      | ‡πÉ‡∏ä‡πâ `with` expression             |
| ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤ (Value Equality) | ‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ô Unit Test                 |

---
##### üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ

> `record` = **"class ‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"**
> ‚úÖ Immutable, ‚úÖ Value Equality, ‚úÖ Syntax ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö
> ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö DTO, Response, Command, Query ‡πÉ‡∏ô Clean Architecture


#### 1.4 Dapper ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
Dapper ‡πÄ‡∏õ‡πá‡∏ô Micro ORM (Object-Relational Mapper) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö .NET ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL Query ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

![image](https://github.com/user-attachments/assets/9b9a7864-5b92-4450-b2a0-292bcea74210)
https://blog.byalex.dev/article/dapper-queries-synchronized-with-mssql-database-schema


#### 1.4 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ:
1.  **Visual Studio 2022** (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏ß‡πà‡∏≤) ‡∏û‡∏£‡πâ‡∏≠‡∏° .NET SDK (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ .NET 8.0 ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏ß‡πà‡∏≤)
2.  **SQL Server Management Studio (SSMS)** ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SQL Server ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
3.  **SQL Server LocalDB** (‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö Visual Studio)
4.  **Postman** ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö API
****

## üõ†Ô∏è ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö Product API ‡∏î‡πâ‡∏ß‡∏¢ .NET 8 + Dapper + Clean Architecture

### üîß Stack ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

* ASP.NET Core Web API
* Dapper (Micro ORM)
* MSSQL LocalDB
* Serilog (Logging)
* Clean Architecture
* SOLID Principles
* Middleware (Exception Handling, Logging, Response Wrapping)

#

## 1Ô∏è‚É£ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Project

```plaintext
ProductAPI/
‚îÇ
‚îú‚îÄ‚îÄ Application        // Business Logic
‚îÇ   ‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îî‚îÄ‚îÄ Services/
‚îÇ
‚îú‚îÄ‚îÄ Domain            // Entity (Business Model)
‚îÇ
‚îú‚îÄ‚îÄ Infrastructure    // Data Access (Repositories, Dapper)
‚îÇ
‚îú‚îÄ‚îÄ Presentation.WebAPI  // API Layer
‚îÇ   ‚îî‚îÄ‚îÄ Controllers/
‚îÇ
‚îú‚îÄ‚îÄ Common            // Shared Models (ApiResponse, Enums, Exceptions)
‚îÇ
‚îî‚îÄ‚îÄ ProductAPI.Tests             // (Optional) Unit Tests
```

#

## 2Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á Database ‡πÅ‡∏•‡∏∞ Table

### üì¶ Database: MSSQL LocalDB

```sql
CREATE TABLE Products (
    Id INT PRIMARY KEY IDENTITY(1,1),
    Name NVARCHAR(100) NOT NULL,
    Description NVARCHAR(255),
    Price DECIMAL(18,2) NOT NULL,
    Stock INT NOT NULL,
    CreatedAt DATETIME NOT NULL DEFAULT GETDATE(),
    UpdatedAt DATETIME NULL
);
```

#

## 3Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á Project ‡πÅ‡∏ö‡∏ö Step-by-Step

### ‚úÖ Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Solution ‡πÅ‡∏•‡∏∞ Project

```bash
dotnet new webapi -n ProductAPI
cd ProductAPI 
```
### ‚úÖ Step 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏° Clean Architecture

```bash
mkdir Domain Application Infrastructure Common
```
‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô VS2022/Explorer:

```
ProductAPI/
‚îú‚îÄ‚îÄ Controllers/
‚îú‚îÄ‚îÄ Domain/              üß† Entities, ValueObjects
‚îú‚îÄ‚îÄ Application/         üß† DTOs, Interfaces, Services
‚îú‚îÄ‚îÄ Infrastructure/      üß† Repositories, DB Access (Dapper)
‚îú‚îÄ‚îÄ Common/              üß† Shared things (ApiResponse, Exceptions, Middlewares)
‚îú‚îÄ‚îÄ Program.cs, appsettings.json, etc.
```
 
#

## 4Ô∏è‚É£ Step-by-Step ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å SOLID ‡πÅ‡∏•‡∏∞ Clean Code)

### ‚úÖ 4.1 ‡∏™‡∏£‡πâ‡∏≤‡∏á Entity (Domain Layer)

üìÅ `Domain/Entities/Product.cs`

```csharp
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; } = string.Empty;
    public string? Description { get; set; }
    public decimal Price { get; set; }
    public int Stock { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime? UpdatedAt { get; set; }
}
```
*‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:* ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `string.Empty` ‡πÅ‡∏•‡∏∞ `?` (nullable reference types) ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Nullability ‡πÉ‡∏ô C# 8.0+

**üß† SOLID Principles:**

* **S (Single Responsibility)**: Entity ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
* Clean Code: ‡∏ä‡∏∑‡πà‡∏≠ class/field ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡πÉ‡∏ä‡πâ type ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

#

### ‚úÖ 4.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO (Application Layer)

üìÅ `Application/DTOs/ProductCreateDTO.cs`

```csharp
namespace ProductAPI.Application.DTOs
{
    public record ProductCreateDTO(string Name, string Description, decimal Price, int Stock);
}
```
üìÅ `Application/DTOs/ProductResponseDTO.cs`

```csharp
namespace ProductAPI.Application.DTOs
{
    public record ProductResponseDTO(int Id, string Name, string Description, decimal Price, int Stock);
}
```
üìÅ `Application/DTOs/ProductUpdateDTO.cs`

```csharp
namespace ProductAPI.Application.DTOs
{
    public record ProductUpdateDTO(int Id, string Name, string Description, decimal Price, int Stock);
}
```


**üß† SOLID Principles:**

* **I (Interface Segregation)**: ‡πÅ‡∏¢‡∏Å DTO ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Entity ‡∏ï‡∏£‡∏á ‡πÜ
* ‡πÉ‡∏ä‡πâ `record` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö, immutable

#

### ‚úÖ 4.3 ‡∏™‡∏£‡πâ‡∏≤‡∏á Interface + Service (Application Layer)

üìÅ `Application/Interfaces/IProductService.cs`

```csharp
namespace ProductAPI.Application.Interfaces
{
    public interface IProductService
    {
        Task<IEnumerable<ProductResponseDTO>> GetAllAsync();
        Task<ProductResponseDTO?> GetByIdAsync(int id);
        Task<ProductResponseDTO> CreateAsync(ProductCreateDTO productDto);
        Task<bool> UpdateAsync(ProductUpdateDTO productDto);
        Task<bool> DeleteAsync(int id);
    }
}
```

üìÅ `Application/Services/ProductService.cs`

```csharp

 // File: Application/Services/ProductService.cs

using ProductAPI.Application.DTOs;
using ProductAPI.Application.Interfaces;
using ProductAPI.Domain.Entities;
using ProductAPI.Domain.Interfaces;

namespace ProductAPI.Application.Services
{
    public class ProductService : IProductService
    {
        private readonly IProductRepository _productRepository;

        public ProductService(IProductRepository productRepository)
        {
            _productRepository = productRepository;
        }

        public async Task<IEnumerable<ProductResponseDTO>> GetAllAsync()
        {
            var products = await _productRepository.GetAllAsync();

            // throw new Exception("Test Exception ProductService---------------");
            return products.Select(p => MapToDTO(p));
        }

        public async Task<ProductResponseDTO?> GetByIdAsync(int id)
        {
            var product = await _productRepository.GetByIdAsync(id);
            return product != null ? MapToDTO(product) : null;
        }

        public async Task<ProductResponseDTO> CreateAsync(ProductCreateDTO productDto)
        {
            var product = new Product
            {
                Name = productDto.Name,
                Description = productDto.Description,
                Price = productDto.Price,
                Stock = productDto.Stock
            };

            product.Id = await _productRepository.CreateAsync(product);
            return MapToDTO(product);
        }

        public async Task<bool> UpdateAsync(ProductUpdateDTO productDto)
        {
            var product = new Product
            {
                Id = productDto.Id,
                Name = productDto.Name,
                Description = productDto.Description,
                Price = productDto.Price,
                Stock = productDto.Stock
            };

            return await _productRepository.UpdateAsync(product);
        }

        public async Task<bool> DeleteAsync(int id)
        {
            return await _productRepository.DeleteAsync(id);
        }

        private static ProductResponseDTO MapToDTO(Product product)
        {
            return new ProductResponseDTO(
                product.Id,
                product.Name,
                product.Description,
                product.Price,
                product.Stock);
        }
    }
}
```
**üß† SOLID Principles:**

* **Single Responsibility Principle (SRP):** `ProductService` ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Business Logic ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Product ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö Repository.
* **Open/Closed Principle (OCP):** ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Feature ‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Method ‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠ Service ‡πÉ‡∏´‡∏°‡πà ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö Method ‡πÄ‡∏î‡∏¥‡∏°.
* **D (Dependency Inversion)**: ‡πÉ‡∏ä‡πâ Interface ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡∏ï‡∏£‡∏á
* **O (Open/Closed)**: ‡πÅ‡∏Å‡πâ Service ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö Layer ‡∏≠‡∏∑‡πà‡∏ô
* Clean Code: Function name ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡πÉ‡∏ä‡πâ LINQ ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
#


### ‚úÖ 4.4 ‡∏™‡∏£‡πâ‡∏≤‡∏á Repository (Infrastructure Layer)

üìÅ `Domain/Interfaces/IProductRepository.cs`

```csharp
public interface IProductRepository
{
    Task<IEnumerable<Product>> GetAllAsync();
    Task<Product?> GetByIdAsync(int id);
    Task<int> CreateAsync(Product product);
    Task<bool> UpdateAsync(Product product);
    Task<bool> DeleteAsync(int id);
}
```

üìÅ `Infrastructure/Repositories/ProductRepository.cs`

```csharp

namespace ProductAPI.Infrastructure.Repositories
{
    public class ProductRepository : IProductRepository
    {
        private readonly string _connectionString; 

        public ProductRepository(IConfiguration configuration)
        {
            _connectionString = configuration.GetConnectionString("DefaultConnection")
                ?? throw new ArgumentNullException(nameof(configuration), "Connection string 'DefaultConnection' not found.");
        }


        public async Task<IEnumerable<Product>> GetAllAsync()
        {
             //throw new Exception("Test Exception ** ProductRepository. GetAllAsync() **"); 
            
            using IDbConnection db = new SqlConnection(_connectionString);
            return await db.QueryAsync<Product>("SELECT * FROM Product2");
        }

        public async Task<Product?> GetByIdAsync(int id)
        {
            using IDbConnection db = new SqlConnection(_connectionString);
            return await db.QueryFirstOrDefaultAsync<Product>(
                "SELECT * FROM Product2 WHERE Id = @Id", new { Id = id });
        }

        public async Task<int> CreateAsync(Product product)
        {
            using IDbConnection db = new SqlConnection(_connectionString);
            var sql = @"INSERT INTO Product2 (Name, Description, Price, Stock) 
                    VALUES (@Name, @Description, @Price, @Stock);
                    SELECT CAST(SCOPE_IDENTITY() as int)";
            return await db.QuerySingleAsync<int>(sql, product);
        }

        public async Task<bool> UpdateAsync(Product product)
        {
            using IDbConnection db = new SqlConnection(_connectionString);
            var sql = @"UPDATE Product2 SET 
                    Name = @Name, 
                    Description = @Description, 
                    Price = @Price, 
                    Stock = @Stock 
                    WHERE Id = @Id";
            var affected = await db.ExecuteAsync(sql, product);
            return affected > 0;
        }

        public async Task<bool> DeleteAsync(int id)
        {
            using IDbConnection db = new SqlConnection(_connectionString);
            var affected = await db.ExecuteAsync(
                "DELETE FROM Product2 WHERE Id = @Id", new { Id = id });
            return affected > 0;
        }
    }
}

```
**üß† SOLID Principles:**
 
 * **Single Responsibility Principle (SRP):** `ProductRepository` ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Product ‡πÉ‡∏ô Database ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Data Access.
 * **Dependency Inversion Principle (DIP):** Implement `IProductRepository` ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢ Application Layer.
#

### ‚úÖ 4.5 Controller (API Layer)

üìÅ `Controllers/ProductsController.cs`

```csharp

namespace ProductAPI.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class ProductsController : ControllerBase
    {
        private readonly IProductService _productService;
        private readonly ILogger<ProductsController> _logger;

        public ProductsController(ILogger<ProductsController> logger ,IProductService productService)
        {
            _productService = productService;
            _logger = logger;
        }

        [HttpGet] 
        public async Task<ActionResult<IEnumerable<ProductResponseDTO>>> GetAllProducts()
        { 
            try
            {
                var products = await _productService.GetAllAsync();

                var response = ApiResponse<IEnumerable<ProductResponseDTO>>.SuccessResponse(
                    data: products,
                    message: "Products retrieved successfully",
                    statusCode: StatusCodes.Status200OK
                );

                //throw new Exception("Test Exception GetAllProducts---------------");
                return Ok(response);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error occurred in GetAllProducts");
                var errorResponse = ApiResponse<object>.FailResponse(
                    message: "An unexpected error occurred while fetching products.",
                    statusCode: StatusCodes.Status500InternalServerError,
                    error: ex.Message // ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö StackTrace ‡∏Å‡πá‡πÑ‡∏î‡πâ
                );

                return StatusCode(StatusCodes.Status500InternalServerError, errorResponse);
            }

        }

        //[HttpGet("api/Products2")]
        //public async Task<ActionResult<ApiResponse<IEnumerable<ProductResponseDTO>>>> Get()
        //{
        //    var products = await _productService.GetAllAsync();          
        //    return Ok(ApiResponse<IEnumerable<ProductResponseDTO>>.SuccessResponse(products));
        //}


        [HttpGet("{id}")]
        public async Task<ActionResult<ApiResponse<ProductResponseDTO>>> Get(int id)
        {
            var product = await _productService.GetByIdAsync(id);
            return product != null
                ? Ok(ApiResponse<ProductResponseDTO>.SuccessResponse(product))
                : NotFound(ApiResponse<ProductResponseDTO>.FailResponse("Product not found", 404));
        }

        [HttpPost]
        public async Task<ActionResult<ApiResponse<ProductResponseDTO>>> Post([FromBody] ProductCreateDTO dto)
        {
            var product = await _productService.CreateAsync(dto);

            //throw new Exception("Test Exception CreatedAtAction -----------------------");
            return CreatedAtAction(nameof(Get), new { id = product.Id },  ApiResponse<ProductResponseDTO>.SuccessResponse(product, "Product created", 201));
        }

        [HttpPut("{id}")]
        public async Task<ActionResult<ApiResponse<object>>> Put(int id, [FromBody] ProductUpdateDTO dto)
        {
            if (id != dto.Id)
                return BadRequest(ApiResponse<object>.FailResponse("Invalid product ID", 400));

            var result = await _productService.UpdateAsync(dto);
            return result
                ? Ok(ApiResponse<object>.SuccessResponse(null, "Product updated"))
                : NotFound(ApiResponse<object>.FailResponse("Product not found", 404));
        }

        [HttpDelete("{id}")]
        public async Task<ActionResult<ApiResponse<object>>> Delete(int id)
        {
            var result = await _productService.DeleteAsync(id);
            return result
                ? Ok(ApiResponse<object>.SuccessResponse(null, "Product deleted"))
                : NotFound(ApiResponse<object>.FailResponse("Product not found", 404));
        }
    }
}

```

*‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Clean Code:*
    * **Clear Naming:** ‡∏ä‡∏∑‡πà‡∏≠ Method ‡πÅ‡∏•‡∏∞ Variable ‡∏™‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢.
    * **Small Methods:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Action Method ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß.
    * **Comments:** ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö.
    * **Logging:** ‡πÄ‡∏û‡∏¥‡πà‡∏° Log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Debug.
    *‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ SOLID:*
    * **Single Responsibility Principle (SRP):** Controller ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ Service Layer. ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ Business Logic ‡πÉ‡∏ô Controller.
    
**üß† SOLID Principles:**

* **D (Dependency Inversion)**: Controller ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Implementation
* Clean Code: Response ‡πÄ‡∏õ‡πá‡∏ô `ApiResponse`, ‡πÅ‡∏¢‡∏Å logic ‡πÑ‡∏õ Service

#

### ‚úÖ 4.6 Middleware + ApiResponse (Shared)

üìÅ `Common/ApiResponse.cs`

```csharp
namespace ProductAPI.Common
{
    public record ApiResponse<T>(int StatusCode, bool Success, string Message, T? Data, string? Error = null)
    {
        public static ApiResponse<T> SuccessResponse(T data, string message = "Success", int statusCode = 200) => new(statusCode, true, message, data);

        public static ApiResponse<T> FailResponse(string message = "Failed", int statusCode = 400, string? error = null) => new(statusCode, false, message, default, error);
    }

}
```

üìÅ `Middleware/ExceptionMiddleware.cs`

```csharp

namespace ProductAPI.Middleware
{
    public class ExceptionMiddleware
    {
        private readonly RequestDelegate _next;
        private readonly ILogger<ExceptionMiddleware> _logger;

        public ExceptionMiddleware(RequestDelegate next, ILogger<ExceptionMiddleware> logger)
        {
            _next = next;
            _logger = logger;
        }

        public async Task InvokeAsync(HttpContext context)
        {
            try
            {
                context.Request.EnableBuffering();
                await _next(context);
            }
            catch (Exception ex)
            {
                // Get Action Name from endpoint
                var endpoint = context.GetEndpoint();
                var actionName = endpoint?.DisplayName ?? "UnknownAction";

                // Read Request Body
                var requestBody = await ReadRequestBodyAsync(context.Request);

                // StackTrace
                var st = new StackTrace(ex, true);
                var frame = st.GetFrames()?.FirstOrDefault(f => f.GetFileLineNumber() > 0);
                var methodInfo = frame?.GetMethod();
                var declaringType = methodInfo?.DeclaringType;

                // Extract original method name (handle async state machine)
                var originalMethodName = declaringType?.Name;
                string methodName;
                if (!string.IsNullOrWhiteSpace(originalMethodName) && originalMethodName.Contains("<") && originalMethodName.Contains(">"))
                {
                    var start = originalMethodName.IndexOf("<") + 1;
                    var end = originalMethodName.IndexOf(">");
                    methodName = originalMethodName.Substring(start, end - start);
                }
                else
                {
                    methodName = methodInfo?.Name ?? "UnknownMethod";
                }

                // Get class name (real class, not compiler generated)
                var className = declaringType?.DeclaringType?.Name ?? declaringType?.Name ?? "UnknownClass";
                var lineNumber = frame?.GetFileLineNumber();

                // Compose Error Detail
                var errorDetail = $"Class: {className}, Method: {methodName}, Line: {lineNumber}, Action: {actionName}, Request: {requestBody}";

                // Log
                _logger.LogError(ex, "Exception occurred: {ErrorDetail}", errorDetail);

                // Return API JSON Response

                context.Items["ExceptionHandled"] = true;

                context.Response.ContentType = "application/json";
                context.Response.StatusCode = StatusCodes.Status500InternalServerError;

                var response = ApiResponse<object>.FailResponse("Internal Server Error", 500, errorDetail);               

                var json = JsonSerializer.Serialize(response);
                await context.Response.WriteAsync(json);
            }
        }

        private async Task<string> ReadRequestBodyAsync(HttpRequest request)
        {
            try
            {
                request.Body.Position = 0;
                using var reader = new StreamReader(request.Body, Encoding.UTF8, leaveOpen: true);
                var body = await reader.ReadToEndAsync();
                request.Body.Position = 0;
                return body;
            }
            catch
            {
                return "Unable to read request body.";
            }
        }

    }
} 

```

üìÅ `Program.cs`

```csharp
using ProductAPI.Application.Interfaces;
using ProductAPI.Application.Services;
using ProductAPI.Domain.Interfaces;
using ProductAPI.Infrastructure.Repositories;
using ProductAPI.Middleware; 
using Serilog;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddControllers();

// Configure Serilog
Log.Logger = new LoggerConfiguration()
    .ReadFrom.Configuration(builder.Configuration)
    .CreateLogger();

builder.Host.UseSerilog();

// Register services
builder.Services.AddScoped<IProductService, ProductService>();
builder.Services.AddScoped<IProductRepository, ProductRepository>();

builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

var app = builder.Build();

// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();
app.UseAuthorization();

// Custom Middleware
app.UseMiddleware<ExceptionMiddleware>();


app.MapControllers();

app.Run();

```

üìÅ `appsettings.json`

```csharp
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=ProductDB;Trusted_Connection=True;MultipleActiveResultSets=true"
  },
  "Serilog": {
    "Using": [ "Serilog.Sinks.Console", "Serilog.Sinks.File" ],
    "MinimumLevel": "Information",
    "WriteTo": [
      { "Name": "Console" },
      {
        "Name": "File",
        "Args": {
          "path": "Logs/log-.txt",
          "rollingInterval": "Day"
        }
      }
    ]
  }
}
```

#

## üîö ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞ SOLID

| ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö                                                  |
| ------- | --------------------------------------------------------------- |
| **S**   | `Product`, `ProductService`, `ProductRepository` ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞ |
| **O**   | ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≤‡∏ô Interface, Middleware                         |
| **L**   | ‡∏ó‡∏∏‡∏Å Class ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô Interface                      |
| **I**   | ‡πÑ‡∏°‡πà‡∏¢‡∏±‡∏î method ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô Interface                          |
| **D**   | Controller ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Implementation (‡πÉ‡∏ä‡πâ DI)                |

## C# Version ‚úÖ

| üß† C# Version     | üß© ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô .NET ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô |
| ----------------- | ------------------------- |
| C# 9.0            | ‚úÖ **.NET 5.0** (Nov 2020) |
| C# 10.0           | ‚úÖ .NET 6.0 (Nov 2021)     |
| C# 11.0           | ‚úÖ .NET 7.0 (Nov 2022)     |
| C# 12.0           | ‚úÖ .NET 8.0 (Nov 2023)     |
| C# 13.0           | ‚úÖ .NET 9.0 (Nov 2024)     |
